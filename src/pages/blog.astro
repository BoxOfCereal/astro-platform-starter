---
import Layout from '../layouts/Layout.astro';

// Import all Markdown and Astro posts dynamically
const mdPosts = import.meta.glob('../pages/posts/*.md', { eager: true });
const astroPosts = import.meta.glob('../pages/posts/*.astro', { eager: true });

// Merge both file types
const allPosts = { ...mdPosts, ...astroPosts };

// Normalize and prepare the list
const posts = Object.entries(allPosts)
    .filter(([path, post]) => {
        const fileName = path.split('/').pop() || '';
        return !fileName.startsWith('_'); // skip private posts
    })
    .map(([path, post]) => {
        // Handle frontmatter from Markdown and Astro exports
        const frontmatter = post.frontmatter || {};
        const fileName = path.split('/').pop() || '';

        return {
            title: frontmatter.title || post.title || 'Untitled Post',
            slug: fileName.replace(/\.(md|astro)$/, ''),
            date: frontmatter.date || null,
            description: frontmatter.description || null
        };
    })
    .sort((a, b) => {
        const aDate = a.date ? new Date(a.date).valueOf() : 0;
        const bDate = b.date ? new Date(b.date).valueOf() : 0;
        return bDate - aDate;
    });
---

<Layout title="Blog">
    <h1 class="mb-10">Blog</h1>
    <ul class="space-y-6">
        {
            posts.map((post) => (
                <li class="border-b border-gray-200 pb-4">
                    <a href={`/posts/${post.slug}`} class="text-blue-600 hover:underline text-xl font-medium">
                        {post.title}
                    </a>
                    {post.date && (
                        <p class="text-sm text-gray-500 mt-1">
                            {new Date(post.date).toLocaleDateString('en-US', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            })}
                        </p>
                    )}
                    {post.description && <p class="text-gray-600 mt-2">{post.description}</p>}
                </li>
            ))
        }
    </ul>
</Layout>
